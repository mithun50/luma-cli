# Luma-CLI

```
â–ˆâ–ˆâ•—     â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—     â–ˆâ–ˆâ•—
â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—      â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â•šâ•â•â•â•â•â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘      â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘
â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•     â•šâ•â•â•šâ•â•  â•šâ•â•       â•šâ•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•
```

<p align="center">
  <a href="https://github.com/mithun50/luma-cli/actions/workflows/ci.yml">
    <img src="https://github.com/mithun50/luma-cli/actions/workflows/ci.yml/badge.svg" alt="CI">
  </a>
  <a href="https://github.com/mithun50/luma-cli/actions/workflows/codeql.yml">
    <img src="https://github.com/mithun50/luma-cli/actions/workflows/codeql.yml/badge.svg" alt="CodeQL">
  </a>
  <a href="https://github.com/mithun50/luma-cli/releases">
    <img src="https://img.shields.io/github/v/release/mithun50/luma-cli?include_prereleases&style=flat" alt="Release">
  </a>
  <a href="https://www.gnu.org/licenses/gpl-3.0">
    <img src="https://img.shields.io/badge/License-GPLv3-blue.svg" alt="License: GPL v3">
  </a>
</p>

<p align="center">
  <a href="https://nodejs.org">
    <img src="https://img.shields.io/badge/Node.js-18+-339933?logo=node.js&logoColor=white" alt="Node.js">
  </a>
  <a href="https://expo.dev">
    <img src="https://img.shields.io/badge/Expo-SDK%2053-000020?logo=expo&logoColor=white" alt="Expo">
  </a>
  <a href="https://reactnative.dev">
    <img src="https://img.shields.io/badge/React%20Native-0.76-61DAFB?logo=react&logoColor=black" alt="React Native">
  </a>
  <a href="https://github.com/mithun50/luma-cli/stargazers">
    <img src="https://img.shields.io/github/stars/mithun50/luma-cli?style=flat&logo=github" alt="Stars">
  </a>
</p>

<p align="center">
  <a href="https://github.com/mithun50/luma-cli/issues">
    <img src="https://img.shields.io/github/issues/mithun50/luma-cli?style=flat" alt="Issues">
  </a>
  <a href="https://github.com/mithun50/luma-cli/pulls">
    <img src="https://img.shields.io/github/issues-pr/mithun50/luma-cli?style=flat" alt="Pull Requests">
  </a>
  <a href="https://github.com/mithun50/luma-cli/commits/main">
    <img src="https://img.shields.io/github/last-commit/mithun50/luma-cli?style=flat" alt="Last Commit">
  </a>
  <a href="https://github.com/mithun50/luma-cli">
    <img src="https://img.shields.io/github/repo-size/mithun50/luma-cli?style=flat" alt="Repo Size">
  </a>
</p>

> **Remote monitoring and control for Antigravity IDE** â€” Access your AI coding sessions from anywhere, get notified when responses are ready, and never miss a generation.

---

## Why Luma-CLI?

Ever started a long AI generation and had to stare at your screen waiting? With Luma-CLI:

```
ğŸ“± Send prompt from your phone
ğŸš¶ Walk away, grab coffee
ğŸ”” Get notified when AI is done
âœ¨ Come back to a ready response
```

---

## Table of Contents

<details>
<summary>Click to expand</summary>

- [Features](#-features)
- [Architecture](#-architecture)
- [Installation](#-installation)
- [Quick Start](#-quick-start)
- [CLI Commands](#-cli-commands)
- [Mobile App](#-mobile-app)
- [Notifications](#-notifications)
- [API Reference](#-api-reference)
- [Configuration](#-configuration)
- [Troubleshooting](#-troubleshooting)
- [Project Structure](#-project-structure)
- [Contributing](#-contributing)
- [License](#-license)

</details>

---

## âœ¨ Features

| Feature | Description |
|:--------|:------------|
| ğŸ“¡ **Remote Access** | Connect via local WiFi or global ngrok tunnel |
| ğŸ”— **Deep Links** | Open app instantly with `luma://` URLs |
| ğŸ”„ **Real-Time Sync** | Live updates with 1-second polling |
| ğŸ’¬ **Remote Control** | Send messages, stop generations, switch modes |
| ğŸ”” **Smart Notifications** | Push alerts when AI finishes generating |
| ğŸš€ **Auto-Launch** | Start Antigravity with debug mode automatically |
| ğŸ“‚ **Workspace Management** | View and switch project directories remotely |
| ğŸ”’ **Secure** | HTTPS with auto-generated SSL certificates |
| ğŸ“± **Mobile App** | Native Expo app for iOS and Android |
| ğŸ¨ **Modern CLI** | Beautiful terminal UI with QR codes |

---

## ğŸ— Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MOBILE APP                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Connect     â”‚  â”‚ Chat View   â”‚  â”‚ Notifications       â”‚  â”‚
â”‚  â”‚ Screen      â”‚  â”‚ (WebView)   â”‚  â”‚ (Expo Notifications)â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ WebSocket / HTTP
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       LUMA SERVER                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Express     â”‚  â”‚ WebSocket   â”‚  â”‚ Polling Loop        â”‚  â”‚
â”‚  â”‚ REST API    â”‚  â”‚ Events      â”‚  â”‚ (Generation Detect) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ Chrome DevTools Protocol
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ANTIGRAVITY IDE                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Chat UI     â”‚  â”‚ AI Models   â”‚  â”‚ Debug Port 9000     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ Installation

### Prerequisites

| Requirement | Version | Check |
|:------------|:--------|:------|
| Node.js | 18+ | `node --version` |
| npm | 8+ | `npm --version` |
| Antigravity IDE | Latest | Must support debug mode |

### Install

```bash
# Clone repository
git clone https://github.com/mithun50/luma-cli.git
cd luma-cli

# Install backend dependencies
npm install

# Install mobile dependencies
cd mobile && npm install && cd ..

# Link CLI globally (optional)
npm link
```

### Verify

```bash
luma-cli --version
# Output: 1.0.0
```

---

## ğŸš€ Quick Start

### Option A: One Command (Recommended)

```bash
luma-cli start --auto-launch
```

This automatically:
1. Launches Antigravity IDE with debug mode enabled
2. Starts the Luma server
3. Displays QR code for mobile connection

### Option B: Manual Setup

**Step 1:** Start Antigravity with Debug Mode

```bash
antigravity . --remote-debugging-port=9000
```

**Step 2:** Launch Luma Server

```bash
luma-cli start
```

---

You'll see:
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    LUMA-CLI v1.0.0                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ” Antigravity launched on debug port 9000
ğŸš€ Starting Luma server in LOCAL mode...
âœ… Found Antigravity on port 9000
âœ… Connected! Found 3 execution contexts

=======================================================
   ğŸ“¡ LOCAL WIFI ACCESS
=======================================================
   ğŸ”— URL:       http://192.168.1.100:3000
   ğŸ“± Deep Link: luma://192.168.1.100:3000
   ğŸ”‘ Passcode:  Not required for local WiFi
=======================================================

ğŸ“± Scan this QR Code to connect:

â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â–ˆ â–„â–„â–„â–„â–„ â–ˆ â–€â–„â–€â–„â–ˆ â–„â–„â–„â–„â–„ â–ˆ
â–ˆ â–ˆ   â–ˆ â–ˆâ–€â–„ â–€â–ˆâ–ˆ â–ˆ   â–ˆ â–ˆ
â–ˆ â–ˆâ–„â–„â–„â–ˆ â–ˆ â–„â–€ â–ˆâ–ˆ â–ˆâ–„â–„â–„â–ˆ â–ˆ
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

--------------------------------------------------
   ğŸ“ Steps to Connect:
   1. Ensure your phone is on the SAME Wi-Fi network
   2. Scan the QR code with Luma app or Camera
   3. The app will auto-connect using the deep link
   âœ¨ Or tap the luma:// link to open directly!
--------------------------------------------------

âœ… Server is running
âŒ¨ï¸  Press Ctrl+C to stop
```

### Step 3: Connect Mobile App

```bash
cd mobile
npx expo start
```

Scan QR code with Expo Go app â†’ Enter server URL â†’ Start chatting!

---

## ğŸ’» CLI Commands

### `luma-cli start`

Start the Luma server.

```bash
# Auto-launch Antigravity + start server (recommended)
luma-cli start --auto-launch

# Auto-launch with specific project directory
luma-cli start --auto-launch --directory ~/my-project

# Interactive mode (choose local/web)
luma-cli start

# Local network mode
luma-cli start --local

# Global access via ngrok
luma-cli start --web

# Custom port
luma-cli start --port 8080

# Combined: auto-launch + web mode + custom port
luma-cli start -a -w -p 8080
```

| Option | Short | Description |
|:-------|:------|:------------|
| `--auto-launch` | `-a` | Auto-launch Antigravity IDE with debug mode |
| `--directory <dir>` | `-d` | Directory to open in Antigravity (default: `.`) |
| `--local` | `-l` | LAN/WiFi mode (default) |
| `--web` | `-w` | ngrok tunnel for global access |
| `--port <number>` | `-p` | Custom port (default: 3000) |

#### ngrok Setup (for `--web` mode)

To use global access mode, you need a free ngrok auth token:

1. **Get token:** https://dashboard.ngrok.com/get-started/your-authtoken

2. **Configure:**
   ```bash
   luma-cli config set ngrok-token YOUR_NGROK_TOKEN
   ```

3. **Start with web mode:**
   ```bash
   luma-cli start --web
   ```

> **Note:** Without an auth token, tunnels expire after ~2 hours. With a token, they persist longer.

#### Local vs Web Mode Comparison

| Feature | Local (`-l`) | Web (`-w`) |
|:--------|:-------------|:-----------|
| **Access** | Same WiFi/LAN only | Anywhere via internet |
| **ngrok Token** | Not required | Required |
| **Setup** | None | ngrok account (free) |
| **Speed** | Faster (direct) | Slightly slower (tunneled) |
| **Use Case** | Home/office use | Remote access, sharing |

---

### `luma-cli config`

Manage configuration.

```bash
# Show current config
luma-cli config show

# Set password
luma-cli config set password mySecretPass

# Set ngrok token
luma-cli config set ngrok-token 2abc123xyz...

# Reset to defaults
luma-cli config reset
```

| Action | Description |
|:-------|:------------|
| `show` | Display current configuration |
| `set <key> <value>` | Set a config value |
| `reset` | Reset all to defaults |

**Config Keys:**

| Key | Environment Variable | Description |
|:----|:---------------------|:------------|
| `password` | `APP_PASSWORD` | Auth password |
| `ngrok-token` | `NGROK_AUTHTOKEN` | ngrok auth token |
| `port` | `PORT` | Server port |

---

### `luma-cli ssl`

Manage SSL certificates.

```bash
# Check SSL status
luma-cli ssl status

# Generate new certificates
luma-cli ssl generate
```

| Action | Description |
|:-------|:------------|
| `status` | Check if SSL certs exist |
| `generate` | Create new self-signed certs |

---

### `luma-cli info`

Display connection info and QR codes.

```bash
luma-cli info
```

Shows:
- Local URL with QR code
- ngrok tunnel URL (if active)
- **Passcode** (for web mode connections)
- Server configuration
- Quick tips

---

## ğŸ“± Mobile App

### Setup

```bash
cd mobile
npm install
npx expo start
```

### Connecting to Server

| Mode | How to Connect |
|:-----|:---------------|
| **Local** | Scan QR code, tap deep link, or enter `http://192.168.x.x:3000` |
| **Web** | Scan QR code, tap deep link, or enter ngrok URL |

**Connection Methods:**

| Method | Description |
|:-------|:------------|
| ğŸ“· **QR Code** | Scan with Luma app or camera to auto-connect |
| ğŸ”— **Deep Link** | Tap `luma://host:port` to open app directly |
| âŒ¨ï¸ **Manual** | Enter server URL in the app |

**Deep Link Format:**
```
luma://192.168.1.100:3000     # Local network
luma://abc123.ngrok.io        # ngrok tunnel (auto HTTPS)
```

**Connection Flow:**
```
1. Start Luma server (shows QR code + deep link)
2. Scan QR code OR tap deep link OR enter URL
3. App auto-connects and you're ready!
```

### Screens

| Screen | Description |
|:-------|:------------|
| **Connect** | Enter server URL or scan QR code |
| **Chat** | View live chat snapshot from Antigravity |
| **Settings** | Change mode/model, workspace, disconnect |

### Controls

| Control | Action |
|:--------|:-------|
| **Send Button** | Send message to AI |
| **Stop Button** | Stop current generation |
| **Mode Toggle** | Switch Fast/Planning mode |
| **Model Selector** | Change AI model |
| **Workspace** | View/switch project directory |

---

## ğŸ”” Notifications

### How It Works

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. USER SENDS MESSAGE                                  â”‚
â”‚     ğŸ“± Mobile App â†’ ğŸ–¥ï¸ Luma Server â†’ ğŸ¤– Antigravity    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. GENERATION STARTS                                   â”‚
â”‚     ğŸ¤– Antigravity starts generating                    â”‚
â”‚     ğŸ” Luma detects via CDP (stop button appears)       â”‚
â”‚     ğŸ“¡ WebSocket: { type: "generation_started" }        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. USER SWITCHES APP                                   â”‚
â”‚     ğŸ“± App goes to background                           â”‚
â”‚     â˜• User grabs coffee                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. GENERATION COMPLETES                                â”‚
â”‚     ğŸ¤– Antigravity finishes response                    â”‚
â”‚     ğŸ” Luma detects (stop button disappears)            â”‚
â”‚     ğŸ“¡ WebSocket: { type: "generation_complete" }       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. NOTIFICATION SENT                                   â”‚
â”‚     ğŸ”” Push notification appears                        â”‚
â”‚     ğŸ“± "AI Response Ready (15s)"                        â”‚
â”‚     ğŸ‘† User taps to view response                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Notification Types

| Type | When | Content |
|:-----|:-----|:--------|
| **Generation Complete** | AI finishes responding | "AI Response Ready (Xs)" |
| **Error** | Connection/API error | Error message |

### Detection Methods

Luma uses multiple methods to detect generation state:

| Method | How It Works | Reliability |
|:-------|:-------------|:------------|
| Stop Button | Detects visible stop button | â­â­â­â­â­ |
| Stop Icon | Detects stop icon (square SVG) | â­â­â­â­ |
| Spinner | Detects loading animations | â­â­â­ |
| Cursor | Detects blinking text cursor | â­â­â­ |
| Input State | Checks if input is disabled | â­â­ |

### Configuration

Notifications are configurable in the mobile app:

```javascript
// In useNotifications hook
notifications.updateSettings({
  enabled: true,        // Master toggle
  sound: true,          // Play sound
  vibrate: true,        // Vibrate device
  onGenerationComplete: true,  // Notify on complete
  onError: true,        // Notify on errors
});
```

---

## ğŸ”Œ API Reference

### Endpoints

| Endpoint | Method | Description |
|:---------|:-------|:------------|
| `/health` | GET | Server health check (includes deep link) |
| `/connection-info` | GET | Get URL and deep link for mobile |
| `/snapshot` | GET | Get chat HTML snapshot |
| `/send` | POST | Send message |
| `/stop` | POST | Stop generation |
| `/set-mode` | POST | Set Fast/Planning mode |
| `/set-model` | POST | Set AI model |
| `/app-state` | GET | Get current mode/model |
| `/workspace` | GET | Get current workspace info |
| `/workspace/recent` | GET | List recent workspaces |
| `/workspace/open` | POST | Open specific directory |
| `/workspace/open-dialog` | POST | Trigger open folder dialog |
| `/remote-click` | POST | Click element |
| `/remote-scroll` | POST | Sync scroll |

### WebSocket Events

| Event | Direction | Payload |
|:------|:----------|:--------|
| `connected` | Serverâ†’Client | â€” |
| `snapshot_update` | Serverâ†’Client | `{ isGenerating, timestamp }` |
| `generation_started` | Serverâ†’Client | `{ timestamp }` |
| `generation_complete` | Serverâ†’Client | `{ duration, timestamp }` |
| `error` | Serverâ†’Client | `{ message }` |

### Examples

<details>
<summary>Health Check</summary>

```bash
curl http://localhost:3000/health
```

Response:
```json
{
  "status": "ok",
  "cdpConnected": true,
  "uptime": 123.45,
  "timestamp": "2025-01-22T12:00:00.000Z",
  "https": false,
  "url": "http://192.168.1.100:3000",
  "deepLink": "luma://192.168.1.100:3000"
}
```
</details>

<details>
<summary>Connection Info</summary>

```bash
curl http://localhost:3000/connection-info
```

Response:
```json
{
  "url": "http://192.168.1.100:3000",
  "deepLink": "luma://192.168.1.100:3000",
  "https": false
}
```
</details>

<details>
<summary>Send Message</summary>

```bash
curl -X POST http://localhost:3000/send \
  -H "Content-Type: application/json" \
  -d '{"message": "Hello, AI!"}'```

Response:
```json
{
  "success": true,
  "messageId": "msg_123"
}
```
</details>

<details>
<summary>Get Snapshot</summary>

```bash
curl http://localhost:3000/snapshot```

Response:
```json
{
  "html": "<div id=\"cascade\">...</div>",
  "css": "...",
  "backgroundColor": "#1a1a2e",
  "scrollInfo": {
    "scrollTop": 0,
    "scrollPercent": 0
  }
}
```
</details>

<details>
<summary>Get Workspace Info</summary>

```bash
curl http://localhost:3000/workspace```

Response:
```json
{
  "directory": "/home/user/my-project",
  "projectName": "my-project",
  "files": []
}
```
</details>

<details>
<summary>List Recent Workspaces</summary>

```bash
curl http://localhost:3000/workspace/recent```

Response:
```json
{
  "workspaces": [
    { "path": "/home/user/project-a", "name": "project-a" },
    { "path": "/home/user/project-b", "name": "project-b" }
  ]
}
```
</details>

<details>
<summary>Open Folder Dialog</summary>

```bash
curl -X POST http://localhost:3000/workspace/open-dialog```

Response:
```json
{
  "success": true,
  "message": "Open folder dialog triggered"
}
```
</details>

---

## âš™ï¸ Configuration

### Environment Variables

Create `.env` in project root:

```env
# Server
PORT=3000

# ngrok (for web mode)
NGROK_AUTHTOKEN=your_ngrok_token

# Advanced (optional)
# CDP_CALL_TIMEOUT=30000
# POLL_INTERVAL=1000
```

### Defaults

| Setting | Default | Description |
|:--------|:--------|:------------|
| `PORT` | 3000 | Server port |
| `CDP_PORTS` | 9000-9003 | Debug ports to scan |
| `POLL_INTERVAL` | 1000ms | Snapshot polling |

---

## ğŸ”§ Troubleshooting

### Connection Issues

<details>
<summary>"Cannot connect to Antigravity"</summary>

1. Use auto-launch (recommended):
   ```bash
   luma-cli start --auto-launch
   ```

2. Or manually enable debug mode:
   ```bash
   antigravity . --remote-debugging-port=9000
   ```

3. Check ports are accessible:
   ```bash
   curl http://localhost:9000/json
   ```

4. Verify health endpoint:
   ```bash
   curl http://localhost:3000/health
   ```
</details>

<details>
<summary>"ngrok tunnel failed"</summary>

1. **Get a token** (if you don't have one):
   - Sign up at https://dashboard.ngrok.com
   - Copy your authtoken from the dashboard

2. **Set the token:**
   ```bash
   luma-cli config set ngrok-token YOUR_TOKEN
   ```

3. **Verify token is set:**
   ```bash
   luma-cli config show
   ```

4. **Check internet connection**

5. **Common errors:**
   - `ERR_NGROK_...` â†’ Invalid or expired token
   - `tunnel session not found` â†’ Token not set
   - `too many connections` â†’ Free tier limit (use local mode instead)

6. **Alternative: Use local mode** (no ngrok needed):
   ```bash
   luma-cli start --local
   ```
</details>

<details>
<summary>"SSL certificate error"</summary>

1. Regenerate certificates:
   ```bash
   luma-cli ssl generate
   ```

2. On mobile, accept self-signed cert warning

3. In browser: Advanced â†’ Proceed anyway
</details>

<details>
<summary>"Notifications not working"</summary>

1. Check permission was granted:
   ```javascript
   // In app, hasPermission should be true
   const { hasPermission } = useNotifications();
   ```

2. Ensure app is in background when testing

3. Check notification settings in phone settings
</details>

---

## ğŸ“ Project Structure

```
luma-cli/
â”œâ”€â”€ bin/
â”‚   â””â”€â”€ luma-cli.js           # CLI entry point
â”‚
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ cdp/                  # Chrome DevTools Protocol
â”‚   â”‚   â”œâ”€â”€ connection.js     # WebSocket connection
â”‚   â”‚   â”œâ”€â”€ discovery.js      # Port scanning
â”‚   â”‚   â”œâ”€â”€ generation.js     # Generation detection â­
â”‚   â”‚   â”œâ”€â”€ interactions.js   # Click/scroll
â”‚   â”‚   â”œâ”€â”€ messaging.js      # Send/stop
â”‚   â”‚   â”œâ”€â”€ settings.js       # Mode/model
â”‚   â”‚   â”œâ”€â”€ snapshot.js       # DOM capture
â”‚   â”‚   â”œâ”€â”€ state.js          # App state
â”‚   â”‚   â””â”€â”€ workspace.js      # Directory switching â­
â”‚   â”‚
â”‚   â”œâ”€â”€ cli/                  # CLI commands
â”‚   â”‚   â”œâ”€â”€ commands/
â”‚   â”‚   â”‚   â”œâ”€â”€ start.js
â”‚   â”‚   â”‚   â”œâ”€â”€ config.js
â”‚   â”‚   â”‚   â”œâ”€â”€ ssl.js
â”‚   â”‚   â”‚   â””â”€â”€ info.js
â”‚   â”‚   â”œâ”€â”€ qrcode.js
â”‚   â”‚   â”œâ”€â”€ tunnel.js
â”‚   â”‚   â””â”€â”€ prompts.js
â”‚   â”‚
â”‚   â”œâ”€â”€ server/               # Express server
â”‚   â”‚   â”œâ”€â”€ express.js
â”‚   â”‚   â”œâ”€â”€ websocket.js
â”‚   â”‚   â”œâ”€â”€ polling.js        # Generation monitoring â­
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/               # API routes
â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚   â”‚   â”œâ”€â”€ chat.js
â”‚   â”‚   â”œâ”€â”€ settings.js
â”‚   â”‚   â”œâ”€â”€ interactions.js
â”‚   â”‚   â”œâ”€â”€ workspace.js      # Directory management â­
â”‚   â”‚   â””â”€â”€ system.js
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚   â”‚   â””â”€â”€ ngrok.js
â”‚   â”‚
â”‚   â”œâ”€â”€ ssl/
â”‚   â”‚   â”œâ”€â”€ generator.js
â”‚   â”‚   â””â”€â”€ openssl.js
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ network.js
â”‚   â”‚   â”œâ”€â”€ process.js
â”‚   â”‚   â”œâ”€â”€ hash.js
â”‚   â”‚   â”œâ”€â”€ passcode.js
â”‚   â”‚   â”œâ”€â”€ logger.js
â”‚   â”‚   â””â”€â”€ antigravity.js    # Auto-launch utility â­
â”‚   â”‚
â”‚   â””â”€â”€ config/
â”‚       â”œâ”€â”€ defaults.js
â”‚       â””â”€â”€ index.js
â”‚
â”œâ”€â”€ mobile/                   # Expo React Native app
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ _layout.js
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”‚
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ChatView.js
â”‚   â”‚   â”œâ”€â”€ ConnectScreen.js
â”‚   â”‚   â”œâ”€â”€ Header.js
â”‚   â”‚   â”œâ”€â”€ InputBar.js
â”‚   â”‚   â””â”€â”€ SettingsModal.js
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useConnection.js
â”‚   â”‚   â”œâ”€â”€ useSnapshot.js
â”‚   â”‚   â”œâ”€â”€ useAppState.js
â”‚   â”‚   â”œâ”€â”€ useNotifications.js  â­
â”‚   â”‚   â””â”€â”€ useWorkspace.js      â­
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ api.js
â”‚   â”‚   â”œâ”€â”€ websocket.js
â”‚   â”‚   â”œâ”€â”€ storage.js
â”‚   â”‚   â””â”€â”€ notifications.js     â­
â”‚   â”‚
â”‚   â””â”€â”€ constants/
â”‚       â”œâ”€â”€ theme.js
â”‚       â””â”€â”€ config.js
â”‚
â”œâ”€â”€ package.json
â”œâ”€â”€ .env.example
â”œâ”€â”€ LICENSE
â””â”€â”€ README.md
```

**â­ = New notification-related files**

---

## ğŸ¤ Contributing

Contributions are welcome!

1. Fork the repository
2. Create feature branch: `git checkout -b feature/amazing`
3. Commit changes: `git commit -m 'Add amazing feature'`
4. Push to branch: `git push origin feature/amazing`
5. Open Pull Request

See [CONTRIBUTING.md](CONTRIBUTING.md) for detailed guidelines.

---

## ğŸ“„ License

**GNU General Public License v3.0**

```
Luma-CLI: Remote monitoring and control for Antigravity IDE
Copyright (C) 2025 Mithun Gowda B

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.
```

See [LICENSE](LICENSE) for full text.

---

<div align="center">

**Made with â¤ï¸ by [Mithun Gowda B](https://github.com/mithun50)**

[Report Bug](https://github.com/mithun50/luma-cli/issues) Â· [Request Feature](https://github.com/mithun50/luma-cli/issues)

</div>
